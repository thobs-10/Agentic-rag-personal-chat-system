services:
  qdrant:
    image: qdrant/qdrant:latest
    container_name: qdrant-db
    volumes:
      - qdrant_data:/qdrant_db
    ports:
      - "6333:6333"
      - "6334:6334"
    environment:
      - QDRANT_SERVER_HOST=0.0.0.0
      - QDRANT_SERVER_PORT=6333
    networks:
      - app-network
    restart: unless-stopped

  backend:
    build:
      context: .
      dockerfile: Dockerfile.backend
    container_name: agentic-rag-backend
    ports:
      - "8000:8000"
    environment:
      - QDRANT_HOST=qdrant
      - QDRANT_PORT=6333
      - LOG_LEVEL=INFO
    networks:
      - app-network
    restart: unless-stopped
    depends_on:
      - qdrant

  # zenml-server:
  #   image: zenmldocker/zenml-server:latest
  #   platform: linux/amd64  # Use amd64 with emulation
  #   container_name: zenml-server
  #   ports:
  #     - "8237:8237"  # Default ZenML server port
  #   networks:
  #     - app-network
  #   environment:
  #     - ZENML_STORE_URI=sqlite:////app/zenml.db
  #     - ZENML_DEFAULT_USER_NAME=default
  #     - ZENML_DEFAULT_USER_PASSWORD=zenml
  #     - ZENML_ANALYTICS_OPT_IN=false
  #     - ZENML_SERVER_HOST=0.0.0.0
  #     - ZENML_SERVER_PORT=8237
  #     - ZENML_LOGGING_VERBOSITY=INFO
  #   volumes:
  #     - zenml_store:/app
  #   restart: unless-stopped
  #   depends_on:
  #     - qdrant

networks:
  app-network:
    driver: bridge

volumes:
  qdrant_data:
    driver: local
  ingestion_data:
    driver: local
